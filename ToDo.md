# To Do 
- [X] Create CRON job that runs the script every few months using second cloud func, checking for updates on all the Wikis and exporting and updating the neccessary files (https://www.youtube.com/watch?v=2OwLb-aaiBQ). 
- [ ] Check variable naming conventions (https://visualgit.readthedocs.io/en/latest/pages/naming_convention.html).
- [X] Check output of bandit and flake8 check.
- [X] Export updates to csv, dataframe.
- [X] Create API so each ISO3166-2 update info can be retrieved as json format, using GCP.
- [X] Create demo using python notebook.
- [X] Generate updated for a particular year. 
- [X] Change all instances of iso3166-updates to iso3166_updates except for pypi name.
- [X] Add GCP upload to workflow.
- [X] Upload all iso3166-updates for all countries in seperate folder of main repo dir.
- [X] If single ISO code put in then print, if mutliple then output to files.
- [X] Append date to update filenames.
- [X] Add maintainer and keywords to setup.py & cfg.
- [X] When using Year var, if DF empty then don't export it.
- [X] Change "Effective date of change" column to "Date issued"
- [X] Change "Newsletter" column to "Edition/Newsletter"
- [X] All countries should have 4 columns: "Edition/Newsletter", "Date issued", "Description of change in newsletter", "Code/Subdivision change"
- [X] href of newsletter not exporting to json
- [X] Add build passing to readme
- [X] Add format section to README and demo.
- [X] Remove .DS_Store and pycache from repo.
- [X] Add API/Google Cloud code to its own folder in repo.
- [X] Make Source repo on GCP, use as import to Cloud Function (https://www.youtube.com/watch?v=LAcErtGU-VU). Creat Cloud Build that builds on push to branch, using repo as source.
- [X] Add diagram of cloud arch & pipeline in API fodler: https://medium.com/google-cloud/use-multiple-paths-in-cloud-functions-python-and-flask-fc6780e560d3
- [X] Add API tests for tests folder - iterate through all iso codes confirming that successful response code returned.
- [X] Update/upload iso3166-updates.json to GCP Stroage in github workflow (https://sha.ws/automatic-upload-to-google-cloud-storage-with-github-actions.html).
- [X] Update Google Cloud Function on push to repo in workflow - if changes made to its folder.
- [X] Add in readme/demo how to use API with requests library.
- [X] Return multiple updates if array of iso_codes applied.
- [X] Replace any null columns with empty string.
- [X] Go through each country and respective ISO3166-2 wiki URL to verify if it's all correct in json.
- [X] Change iso_code to alpha2_code
- [X] Implement GCP in workflow - https://sha.ws/automatic-upload-to-google-cloud-storage-with-github-actions.html
- [X] Dict keys in API output not ordered in correct way - reindex
- [X] Change "Date issued" to "Date Issued"
- [X] Accept list of iso codes or string seperated by comma for main python script - use regex to check correct format.
- [X] Several instances where "Online Browsing Platform" wrriten as "Online BrowsingPlatform" e.g BG, BY
- [X] Validation in get_updates_df func, if input table is not type list & >1 then raise exception.
- [X] Update get_updates comments.
- [X] In code & comments change any var refereneces to "iso" to "iso3166" for clarification.
- [X] API can accept year input with greater or less than symbol.
- [X] Main software can accept year input with greater or less than symbol.
- [X] Date missing from some elements of json in API.
- [X] Incorporate fix that takes into account multiple changes tables: e.g https://en.wikipedia.org/wiki/ISO_3166-2:PA
- [X] Some files saving as e.g "iso3166-updates-AD-[].csv" or "iso3166-updates-AD-.csv"
- [X] For secondary tables, add Edition/Newsletter as Online Browsing Platform - "The following changes to the entry are listed on ISO's online catalogue, the Online Browsing Platform:"
- [X] Add year range to iso3166_updates.py, allows user to input year range and relevant updates are returned.
- [X] Search by alpha3 code in API.
- [X] Instead of seperate alpha2 and alpha3 codes, if alpha2 empty then use alpha3 vice versa, only one set of alpha codes passed in.
- [X] Remove alpha3, would have to convert to alpha2.
- [X] Double check countries with no updates are empty like {} not {''} e.g BM, AX.
- [X] Remove any wiki references/links for regions within "Code/Subdivison Change" column, e.g AF
- [X] AM, GM, GH, ZM, AT, BN, BT, CG, CU, CY, DZ, EE, FM, IQ, IS, KI, KP, KZ, LT, NA, SI, SM, ST, SZ, TJ, TT missing 
Edition/Newsletter - should be OBP.
- [X] QA missing Edition/Newsletter - should be OBP.
- [X] AF, BW, CZ - ensure that newlines in a column are not being concatted into one.
- [X] Add demo link to Colab to readme
- [X] Remove info about ISO3166-1 from intro on readme
- [X] Go over year input parameter in software. 
- [X] https://us-central1-iso3166-updates.cloudfunctions.net/iso3166-updates?alpha2=FR&year=2018,201 - remove invalid years from year input and just use 2018 in this example.
- [X] If invalid year/type input to python script, return all updates for inputted alpha2/s
- [X] If invalid alpha2 input then export all updates data (python3 iso3166_updates.py --alpha2=adkad)
- [X] Unit tests that test if Edition/Newsletter columns are not empty.
- [X] Unit tests that test some alpha2 codes that have no Updates/Changes Section.
- [X] For all unit tests add country name beside alpha2 code & change e.g test_alpha1_code -> test_ad_code
- [X] Add how to use API using Python requests in ReadMe of api folder.
- [X] In API, for year param, if country has rows for selected year/year range, remove from output, rather than having [ ].
- [X] Add space between colon and next char, e.g KE - "Deleted codes:KE-110, KE-200, KE-3" (has negative effect on some other update entries, destructive action)
- [X] For unit tests: output single row of expected dataframe to array (e.g sn_updates_df.iloc[1].to_numpy()).
- [X] Add Code Coverage.
- [X] Add green MIT logo to Readme (https://shields.io/category/license).
- [ ] Create logo for API.
- [X] If invalid input param put into URL then return empty dict instead.
- [X] Example on reamde and demo of how to use API using JS axios library (https://www.taniarascia.com/how-to-connect-to-an-api-with-javascript/).
- [X] Add diagram of CRON job workflow to worklfow dir on repo, including Email Cloud Func.
- [X] If json file is different in repo, upload to Cloud Storage.
- [X] Passing in single string as alpha2_codes to get_updates func returns None.
- [X] Remove if __name__ == "main" from software script. 
- [X] Software can accept list of alpha2 codes e.g "GY, HI, LU, MD"
- [X] Add try, except to Python requests.get in software, don't do it in unit tests.
- [X] For 3rd test in test_get_updates_df tests, add array/list of correct column headers, use this array instead of list.
- [X] Finalise unit tests for get_updates() func.
- [X] Fix CSV file naming conventions when multiple alpha2 codes input to get_updates() func.
- [X] concat_csv param in get_updates() that determines whether to seperate inputted alpha2 updates into seperate or the same json file.
- [X] Create notification function that emails me when an update is found from CRON job workflow (https://documentation.matillion.com/docs/2434849). Add to workflows folder.
- [X] Upload any found updates from check_for_updates function to GCP bucket, download same object in email_updates func.
- [X] Add month unit tests to api tests.
- [X] Add month param to software.
- [X] Mention the earliest Date Issued was 2000-06-21.
- [X] Implemenet API gateway and endpoints for Cloud Func - update cloud arch image to include gateway, endpoints, load balancer, instance group, template etc.
- [X] Test concat_updates param in unit tests.
- [X] Add path-ignore keywords to GitHub Action.
- [X] Update api/readme to incorporate new api gateway.
- [X] Update api config / gateway if api config file changed. Documentation requires new one to be created. Create new one (iso3166-updates-config-2), delete old one (iso3166-updates), then create new one (iso3166-updates), delete old new one (iso3166-updates-config-2) 
- [ ] Add terraform script for cloud arch.
- [X] Mention intended audience in readme.
- [ ] Add api landing page with documentation, similar to restcountries.
- [X] Add years to input param of get_updates func, use tupele of (alpha2, year)
- [X] Reorder software metadata in setup.py to be in order of main func, create __description__ var.
- [X] Add download_url to setup.py - url of zipped package.
- [X] Update api tests to reflect updated url. 
- [X] Mention schedule that check-for-updates is run and that it is appropriate to the general release of updates by the ISO 3166.
- [ ] Remove all camel casing function names/vars, change to underscores and lowercase (https://peps.python.org/pep-0008/#function-and-variable-names).
- [X] Move from GCP to vercel.
- [X] Remove generate report from workflow
- [X] Create Python Flask App -> Deploy to Vercel -> Connect to domain.
- [X] Make bucket and iso3166-updates.json file publicly accessible.
- [X] When updating file in bucket, ensure it is publicy accessible.
- [X] Create vercel deployment pipeline in Github workflow.
- [X] Create API endpoint for https://iso3166-updates.com/api and make main https://iso3166-updates.com a more visual frontend for the app with a dropdown of available countries, years etc.
- [X] Fix pytest badge on readme.
- [X] Unit test new api to double check invalid responses are returning correct message and status.
- [X] When check-for-updates is called and updates are found, programmatically raise an issue in the relevant repositories with a formatted description of the updates found (https://stackoverflow.com/questions/31767596/github-is-there-a-way-to-programmatically-file-an-issue). Instead of creating a new Issue each time, could update the same Issue with new data (https://gist.github.com/JeffPaine/3145490?permalink_comment_id=2558013).
- [X] Change default month in check-for-updates from 12 to 6.
- [X] Update api readmes to reflect new Create Issue functionality.
- [X] Reformat Date Issued from 2022-11-29 to 29-11-2022 (dd-mm-yyyy), mention that it's formatted as such as it's the most common format.
- [X] Have example on readme for getting all updates for all countries. 
- [X] After reformatting Date Issued, dates are out of order '27-11-2015' before 15-11-2016. May need to sort by column then convert into new format.
- [X] Append alpha-2 code to exported json filename. If more than one alpha-2 codes, seperate by comma.
- [X] iso.get_updates(["HI, LV"]) - passing in list of alpha-2 codes should pull updates.
- [X] Create unit test that check exported json filename contains multiple alpha2-codes appended to it.
- [X] Comment that concat_updates only works for JSON outputs as wouldn't for csv.
- [X] Actually return the json of updates from get_updates func. Update unit tests such that more of a focus on the output object than the json.
- [X] Append list of alpha-2 codes with updates to ISO3166-2 Updates: 09-05-2023 (here).
- [X] https://github.com/codecov/codecov-action/issues/559
- [X] Check for unit tests for passing in alpha3 code into API.
- [X] Reconfigure date format to format Y-m-d. Will need to rerun software.
- [X] Update check-for-updates API to use GCP Client library instead of requests after making storage bucket unpublic.
- [X] In check-for-updates, verify that the new updates aren't already in updates.json object. Currently, it may just Create an Issue if updates are found in specified month period, regardless if they're in object. Current behaviour creates issue regardless.
- [X] Update api to reflect updates from frontend.
- [X] API unit tests, pass in invalid 3 letter alpha-3 code, should return error message.
- [X] Remove request.args or request_json from api, probably only need one.
- [X] In check-for-updates, if new updates are found in month range, move old updates.json to an archive file with its date appened to filename, save new updates.json to root folder.
- [X] Rename vars in check-for-updates to make more clear the current and old updates jsons.
- [X] Update return message in check-for-updates to be flask error message response.
- [X] Update software to be able to accept alpha-3 codes.
- [X] Update API cloud arch to incorporate new archive folder and Create Issue functionality.
- [X] Create Issue seems to add all updates from month range rather than just those updates that aren't in json.
- [X] check-for-updates not working: need to publish new version of software, updates using d-m-Y format addtionally being appended with updates in format Y-m-d.
- [X] Unit tests to check all Date Issued in correct format. 
- [X] Change all date formats back to original in unit tests.
- [X] In API, incorporate different API endpoints for parameters, e.g /alpha2, /year, /months.
- [X] Update api.md to incorporate new endpoints/paths.
- [X] Unit tests for ">year" and < year , go through each entry and Date Issued, check they're all less than or greater than input year.
- [X] API unit tests for alpha2 + year path when no year specified (https://iso3166-updates-frontend-amckenna41.vercel.app/api/alpha2/AD/year) - should return all results for AD.
- [X] Double check '>' and '<' work for API url, may need to unicode decode these.
- [X] Change license from MIT to MPL or BSD. Find which one works best.
- [X] Add examples for use of month query parameter in api.md and iso3166-updates-api.
- [X] Unit tests that validate when using query string params that 
- [X] Convert alpha2/alpha3 to alpha-2/alpha-3 in test modules.
- [X] Update and add some more examples to api.md.
- [X] Run vulture library to search package and remove any unused code/vars.
- [X] Pull request for django-countries (https://github.com/SmileyChris/django-countries/tree/main). Update data.py and __init__.py using iso3166_2.json to get list of subdivision names and flags.
- [X] For tableToArray test, pass in wrong data type, int, bool etc.
- [X] Combine error tests of same type into one Test case.
- [X] In get_updates_df(), provide validation if input array parameter isnt array/list.
- [X] Double check year_range, greater_than and less_than need to be passed into get_updates_df.
- [X] Go through updates object country by country, comparing its output and that of wiki.
- [X] Include tests for year param in iso3166.get_updates(year=[])
- [X] If no alpha2 input param values input but year is then append year to filename, append list of years if less than 10 years input e.g iso3166-updates-RU-2011,2022.json, iso3166-updates-RU-2011,2022.csv
- [X] Unit tests for testing above filename convention.
- [X] Seperate export_json and export_csv filename variables into one export_filename var.
- [X] Currently if year passed in as var, all alpha2 codes are added to JSON, remove any empty ones.
- [X] Concat updates in csv file as well, add primary key column of alpha2 iso3166-1 code, only add column if one or more alpha2 codes present.
- [X] Unit tests for testing new primary key column in csv export.
- [X] In readme include examples of calling the main script from terminal, export_csv and export_json called by --export_json/--no-export_json.
- [X] Update comments in iso3166_updates.py to reflect new export_csv concat functionality.
- [X] python3 iso3166_updates.py --alpha2=ES,IE,FR --export_csv --no-concat_updates (doesnt produce individual csv files).
- [X] python3 iso3166_updates.py --alpha2=ES,IE,FR --no-concat_updates --year=2011 --export_csv : doesn't append year to filename.
- [X] Arrows in csv output (->) get converted into ,Üí - convert → to -> :
if unicodedata.name('→') == 'RIGHTWARDS ARROW' then convert to ->
- [X] Convert small functions in iso3166_updates.py into lamda functions.
- [X] Unit tests to test → not in any entries. 
- [X] Don't remove empty dicts when all country updates being generated.
- [X] Unit tests for CSV that has all updates from it.
- [X] If no updates found, export empty json but don't export empty csv, even if export_csv=True
- [X] python3 iso3166_updates.py --alpha2=ES,IE,FR --no-concat_updates --year=2011 --export_csv : exports empty CSVs. /iso3166_updates/test-iso3166-updates/iso3166-updates-ES-2011.csv 
- [X] If  no updates found for singular country export, export {} rather than "ES" : {} 
- [X] Include unit tests for json, open each json, validate keys and length.
- [X] Validate API returns {} when single alpha-2 input and no updates found e.g /alpha2/DE should return {} not "DE": {}.
- [X] Update iso3166-updates.json on repo and GCP with new updated functionality.
- [X] In unit tests, don't append alpha-2 codes to filename, this should automatically be done in code (export_filename +).
- [X] Update filename when Year input parameter input with greater than/less than or year range.
- [X] Get rid of export_json_filename and csv export_json_filename to just have one export_filename.
- [X] Add year range tests for test_alpha2 and test_alpha2_year test cases.
- [X] Add /year/alpha2 path to api repo, currently just has alpha2/year path e.g https://iso3166-updates.com/api/year/2027/alpha2/ie.
- [X] Add params arg to requests.get()
- [X] In unit tests, change test_request var to name more appropriate to test case.
- [X] Add "gt" or "lt" to any vars/requests that are using greater than/less than years etc.
- [X] In unit tests, change datetime.datetime to datetime.
- [X] Remove any instance of "test_request" var in unit tests.
- [X] Change arrow from → to -> in api unit tests after reupload.
- [X] Reupload iso3166-updates.json - empty dicts e.g AX not showing up in output.
- [X] Double check images on repo appear after changing from private to public.
- [X] Add test cases comments to test class.
- [X] Fix spacing in wikis: e.g "Subdivisions added:7 parishes" should be "Subdivisions added: 7 parishes". Find newline character.
- [X] Add '.' to end of each json key.
- [X] Note that for Date Issued column, corrected date is taken on not original for an update, if applicable.
- [X] Issue for https://en.wikipedia.org/wiki/ISO_3166-2:TR update 2011-12-13, link to Newsletter is .pdff not .pdf, need to manually change this.
- [X] May need to use both data sources of wiki and ISO, ISO only contains "Short Description of change" column, wiki contains that + the "Code/Subdivision Change" and "Edition/Newsletter" columns which provides some extra info. 
- [X] In demo, have selenium install script in a cell.
- [X] Mention in reamde that ISO website and wiki have seperate columns and data sometimes hence this project combines the 2 data sources.
- [X] Move selenium stuff to own script.
- [X] Fix bot detection on ISO website.
- [X] Change software approach, iso3166-updates package shouldn't pull all the updates data from the various sources each time, the software should just be used to access the upates json file. Move updates functionality to a get_updates.py script outside of pacakge. 
- [X] Randomise user-agent.
- [X] Might need to execute the script one by one for all countries. Make a bash script that executes the Python script with a random allocted pause in between each alpha-2.
- [X] Ignore any auxilary files using MANIFEST file.
- [X] Ensure correct file are included/excluded from pypi package.
- [X] Change unit tests to test exported json file itself.
- [X] Shell script currently exporting combined jsons wrapped in an array, should just be a dict.
- [X] Json not concatenating properly
- [X] Add XK manually to JSON.
- [X] Some countries missing from JSON, e.g MZ - rerun shell script. MZ, PY, SK, VU, XK.
- [X] Might need to change up GCP Cloud arch to incorporate running selenium on cloud. Put check-for-updates func in Docker container. Test process using a simple app.
- [X] Update api.md file, need to add example of using /name path. Update readme about list of endpoints to include /name.
- [X] Add unit tests for name endpoint - can take from iso3166-2 unit tests for name.
- [X] Remove double spacing from string: import re, re.sub(' +', ' ', 'The     quick brown    fox').
- [X] Try recreating the driver on each iteration - https://stackoverflow.com/questions/58968078/max-retries-exceeded-with-url-selenium.
- [X] Add use_selenium flag to just get wiki data not selenium, add to check-for-updates func.
- [X] Add get_driver() function from check-for-updates to main file on repo.
- [X] Mention check-for-updates microservice in readme.
- [X] Rerun get all script to remove some instances of double spacing, e.g "AZ".
- [X] Mention selenium required as a session is needed for ISO website and both data sources in readme.
- [X] Outstanding error in check-for-updates, new updates not being uploaded.
- [X] updates.json not importing correctly in module.
- [X] Make output of .year() function subscriptable, using Map class.
- [X] Remove space after colon in Parameters & Returns comments in each function.
- [X] Add API path /name/input_name/year/2015. Add unit tests.
- [X] Test check-for-updates with use_selenium=False.
- [ ] Add link to medium article on readme.
- [X] In check-for-updates for AD, earlier table being pulled.
- [X] Test check-for-updates on get_latest_updates notebook.
- [ ] Have a look over varnames and see if some can be changed into more intutive names.
- [X] In check-for-updates readme mention how long it takes to execute Cloud Run app.
- [X] Currently check-for-updates app only checks for any updates in the month range, but add functionality that returns missing/old updates that should be in object.
- [X] Create new var called missing_historical_data, seperate these updates from ones in date range. Have section at bottom of GitHub Issue highlighting these historical missing data.
- [X] Double check colab example again.
- [X] Rerun notebook example once new updates json added to software.
- [X] Create notebook for get_all script, easier to run and follow - download notebook and put in repo.
- [X] test check-for-updates with subsample of alpha-2 codes including FJ.
- [X] Update object in bucket regardless of new date range changes but keep var that tracks object for create_issue func.
- [X] https://en.wikipedia.org/wiki/ISO_3166-2:NO has "Changes Made" column instead of "" 
- [X] For env vars in gcloud beta run, change "github-repo" to "github_repo"
- [X] Mention in check-for-updates readme/comments that the app doesnt just check for udpates in month range but also overall missing data/updates and that outputs are tabulated for each country.
- [X] In check-for-updates, output all missing/new updates into a table.
- [X] Rerun get_all script and update object is main source code dir.
- [X] In check-for-updates: validate env var exists (if environ.get('Foo') is not None), if not then skip command etc.
- [X] Apply double-spacing removal func to each column in dataframe rather than at the table_to_array level.
- [X] Double check success message in check-for-updates.
- [X] Outstanding error in check-for-updates: object not exporting correctly.
- [X] GitHub issue not being created - double check request size limit for post request.
- [X] Double check no entires have both Subdivision Change & Descripton of change == "", if so then remove entry - KN.
- [X] Updates with date corrected in Date Issued column. Add "Corrected" to Date Issued col, need to update api and software etc to remove "corrected" when searching for update. Searching for year will return both original and corrected.
- [X] Replace dateColName var with hard coded "Date Issued".
- [X] Any Date Issued with "corrected" in them will return the original date not corrected one.
- [X] Create new col called CorrectedDateIssued, add to every update. After function to sort each update by Date Issued go through all CorrectedDateIssued columns, if empty drop column else append date to Date Issued col. 
- [X] If Description of change, Code/Subdivion Change and Date Issued are similar, drop duplicate e.g Hondurus.
- [X] Year param in get_updates() func not working.
- [X] Go through all unit tests, any tests that are wrapped in with.selfAssertRaises()... , remove var assignment and just call function.
- [X] Comment out binary_location in get_all script.
- [X] When correcting date using re.sub, can just use that on all Date Issud values as it wont effect the outcome.
- [X] Go over main readme's.
- [X] In check-for-updates check that archive_folder is actually storing archive json and not duplicate of one on main folder **.
- [X] In check-for-updates double check archive functionality still works.
- [X] When mentioning any repo secrets relating to GCP, prefix with GCP_
- [X] In check-for-updates look into different status codes, return message if request gets status code.
- [X] Change all comment underlining from "------" to "=======", including on colab notebook.
- [X] Add methods comments to iso3166-updates class.
- [X] Add 🧪 to tests and desc.
- [X] In readme's, if mentioning other softwares, wrap in `` and add link to repo.
- [X] Update latest changes data on readme.
- [X] Rerun script
- [X] Gcloud run script + call it and then delete it, all in one command.
- [X] Remove space between colon in arguments/returns comments.
- [X] Fix runtime error: RuntimeError: Runtime error that occurs when Selenium hasn't properly parsed ISO website, may need to rerun script again. Maybe increase minimum time before getting ISO website data.
- [X] Mention on main readme that changes are mainly made to the ISO 3166-2 naming covnentions but some are occaisinally made to ISO 3166-1.
- [X] For any Online Browsing Platform entries - append URL to it https://www.iso.org/obp/ui/#iso:code:3166:ET etc. Update readme and changes.md.
- [X] Rerun script in notebook - export and create_issue = 1.
- [X] Updates that already have OBP in their Edition/Newsletter - missing hyphen in between - rerun script.
- [X] Change all references of ISO 3166-2 changes to ISO 3166 chabges.
- [ ] Add github release.
- [X] Extract modification remarks part 1, 2 and 3.
- [ ] Don't need two change/updates attributes in output object.
- [X] Update readme with new column/attribute.
- [X] Only add remark if update has "modification of remarks in the text".
- [X] Mention in readme that pulling in from wiki as well, as it has some of the older updates, ones from earlier newsletters (e.g IM).
- [ ] Change Descripton of change ... to just Descripton of change.
- [X] Append remark to only latest updates entry. 
- [X] When adding remark, lowercase the first letter of remark.
- [X] Mention # of tests and test cases in test readme (20 + 3 skipped).

Future Additions
----------------
- [X] Docs on readthedocs, readthedocs badge - [![Documentation Status](https://readthedocs.org/projects/ansicolortags/badge/?version=latest)](http://ansicolortags.readthedocs.io/?badge=latest) 